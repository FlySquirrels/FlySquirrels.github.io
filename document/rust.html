<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>RUST | yunsheng</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/doc/favicon.ico">
    <meta name="description" content="月下飞天镜，云生结海楼。">
    
    <link rel="preload" href="/doc/assets/css/0.styles.fb5a3bd8.css" as="style"><link rel="preload" href="/doc/assets/js/app.2b83dd76.js" as="script"><link rel="preload" href="/doc/assets/js/2.469a01de.js" as="script"><link rel="preload" href="/doc/assets/js/1.3a15481a.js" as="script"><link rel="preload" href="/doc/assets/js/27.844e8af5.js" as="script"><link rel="prefetch" href="/doc/assets/js/10.dea746cd.js"><link rel="prefetch" href="/doc/assets/js/11.f2c0161d.js"><link rel="prefetch" href="/doc/assets/js/12.2340b856.js"><link rel="prefetch" href="/doc/assets/js/13.78dad766.js"><link rel="prefetch" href="/doc/assets/js/14.8cbc013a.js"><link rel="prefetch" href="/doc/assets/js/15.33db6b39.js"><link rel="prefetch" href="/doc/assets/js/16.de92937a.js"><link rel="prefetch" href="/doc/assets/js/17.ef4d8cc7.js"><link rel="prefetch" href="/doc/assets/js/18.3256f17f.js"><link rel="prefetch" href="/doc/assets/js/19.a45744ea.js"><link rel="prefetch" href="/doc/assets/js/20.d8b02aac.js"><link rel="prefetch" href="/doc/assets/js/21.3622f45b.js"><link rel="prefetch" href="/doc/assets/js/22.5ba155b7.js"><link rel="prefetch" href="/doc/assets/js/23.d1b05fed.js"><link rel="prefetch" href="/doc/assets/js/24.aef77f4c.js"><link rel="prefetch" href="/doc/assets/js/25.18d3e961.js"><link rel="prefetch" href="/doc/assets/js/26.37b359b5.js"><link rel="prefetch" href="/doc/assets/js/28.fd99f11b.js"><link rel="prefetch" href="/doc/assets/js/29.e8bf233d.js"><link rel="prefetch" href="/doc/assets/js/3.c33b3aaa.js"><link rel="prefetch" href="/doc/assets/js/30.09e648cd.js"><link rel="prefetch" href="/doc/assets/js/31.e2afa9d5.js"><link rel="prefetch" href="/doc/assets/js/32.2955d2fa.js"><link rel="prefetch" href="/doc/assets/js/33.ecdce481.js"><link rel="prefetch" href="/doc/assets/js/34.3652ee29.js"><link rel="prefetch" href="/doc/assets/js/35.5469eba7.js"><link rel="prefetch" href="/doc/assets/js/36.8cc63bb1.js"><link rel="prefetch" href="/doc/assets/js/4.1fe653f5.js"><link rel="prefetch" href="/doc/assets/js/5.621b76c0.js"><link rel="prefetch" href="/doc/assets/js/6.24474fce.js"><link rel="prefetch" href="/doc/assets/js/7.b775b056.js"><link rel="prefetch" href="/doc/assets/js/vendors~docsearch.5a4296f1.js">
    <link rel="stylesheet" href="/doc/assets/css/0.styles.fb5a3bd8.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/doc/" class="home-link router-link-active"><!----> <span class="site-name">yunsheng</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/doc/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">
  实用工具
</a></div><div class="nav-item"><a href="/doc/onliegame/" class="nav-link">
  云界游戏文档
</a></div><div class="nav-item"><a href="/doc/document/rust.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  学习文档
</a></div><div class="nav-item"><a href="https://github.com/FlySquirrels/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/doc/" class="nav-link">
  主页
</a></div><div class="nav-item"><a href="/doc/tools/" class="nav-link">
  实用工具
</a></div><div class="nav-item"><a href="/doc/onliegame/" class="nav-link">
  云界游戏文档
</a></div><div class="nav-item"><a href="/doc/document/rust.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  学习文档
</a></div><div class="nav-item"><a href="https://github.com/FlySquirrels/docs" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>学习笔记</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/doc/document/rust.html" aria-current="page" class="active sidebar-link">rust基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/doc/document/rust.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#入门神例" class="sidebar-link">入门神例</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#cargo知识" class="sidebar-link">Cargo知识:</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#通用编程概念" class="sidebar-link">通用编程概念</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#异常处理" class="sidebar-link">异常处理</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#泛型-trait和生命周期" class="sidebar-link">泛型,Trait和生命周期</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#自动化测试" class="sidebar-link">自动化测试</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#迭代器与闭包" class="sidebar-link">迭代器与闭包</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#智能指针" class="sidebar-link">智能指针</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#并发" class="sidebar-link">并发</a></li><li class="sidebar-sub-header"><a href="/doc/document/rust.html#其他知识点" class="sidebar-link">其他知识点</a></li></ul></li><li><a href="/doc/document/log4j2.html" class="sidebar-link">Log4j2</a></li><li><a href="/doc/document/Godot.html" class="sidebar-link">Godot</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="rust"><a href="#rust" class="header-anchor">#</a> RUST</h1> <h2 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h2> <ol><li>安装 Rust 程序设计语言 (rust-lang.org)</li> <li>下载安装环境
<ul><li><a href="https://www.rust-lang.org/zh-CN/tools/install" target="_blank" rel="noopener noreferrer">https://www.rust-lang.org/zh-CN/tools/install<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> 下载安装 <strong>c++编译器</strong></li> <li>运行rustup-init</li> <li>创建RUST_HOME,并将cargo\bin目录添加到系统变量中</li> <li>rustc --version 检查是否安装rust</li></ul></li> <li>配置项目环境
<ul><li>进入cargo目录,删除.package-cache文件</li> <li>创建一个名为config的无后缀文件</li></ul> <div class="language-config line-numbers-mode"><pre class="language-text"><code>    [source.crates-io]
    replace-with = 'sjtu' # 指定使用下面哪个源，修改为source.后面的内容即可
    
    # 中国科学技术大学
    [source.ustc]
    registry = &quot;https://mirrors.ustc.edu.cn/crates.io-index&quot;
    
    # 上海交通大学
    [source.sjtu]
    registry = &quot;https://mirrors.sjtug.sjtu.edu.cn/git/crates.io-index/&quot;
    
    # 清华大学
    [source.tuna]
    registry = &quot;https://mirrors.tuna.tsinghua.edu.cn/git/crates.io-index.git&quot;
    
    # rustcc社区
    [source.rustcc]
    registry = &quot;https://code.aliyun.com/rustcc/crates.io-index.git&quot;
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div></li></ol> <h2 id="入门神例"><a href="#入门神例" class="header-anchor">#</a> 入门神例</h2> <ol><li>创建工程 hello_world文件夹</li> <li>新建文件main.rs</li> <li>添加代码
fn main() {
println!(&quot;你好世界&quot;);
}</li> <li>编译:rustc main.rs</li> <li>运行:<code>Windows-&gt; .\main.exe Linux-&gt; ./main</code></li></ol> <h2 id="cargo知识"><a href="#cargo知识" class="header-anchor">#</a> Cargo知识:</h2> <ol><li>构建系统和包管理器(Cargo)
<ul><li>使用命令
<ul><li>cargo new xxx_xxx:构建项目</li> <li>cargo check:检查项目是否可运行</li> <li>cargo build:打包生成项目</li> <li>cargo build --release优化编译项目,使rust代码运行更快</li> <li>cargo run --release运行优化编译项目</li> <li>cargo update:更新依赖</li> <li>cargo-version 检查是否安装cargo</li></ul></li> <li>构建项目
<ul><li>创建名为hello_cargo的项目</li> <li>cargo new hello_cargo</li> <li>目录结构</li> <li>hello_cargo</li> <li>src</li> <li>—main.rs</li> <li>gitigonre</li> <li>Cargo.lock</li> <li>Cargo.toml</li> <li>src:源代码路径</li> <li>.gitigonre:初始化一个git仓库,可以使用 --vcs=git覆盖行为</li> <li>toml:Cargo的配置文件格式,package配置包,dependencies添加依赖</li> <li>lock:Cargo的自动化可重现构建,确保每次构建的代码一致</li></ul></li></ul></li></ol> <h2 id="通用编程概念"><a href="#通用编程概念" class="header-anchor">#</a> 通用编程概念</h2> <ol><li>Rust是一种静态类型的语言,必须在编译器知道所有变量的类型</li> <li>变量和可变性
<ul><li>let修饰的变量是不可变的,不能被二次赋值</li> <li>	let mut修饰的变量是可变的</li></ul></li> <li>遮蔽
<ul><li>let修饰的变量可以被再次调用</li> <li>let变量名可以重复声明赋值,改变变量对应的值,影响范围是当前作用域(即代码块内)</li> <li>在代码块内更改的变量只在代码块内生效</li></ul></li> <li>常量
<ul><li>const SECRET:u32=997788;</li> <li>常量不允许使用mut.常量不仅仅默认不可变,而且自始至终不允许更改的值</li> <li>使用const关键字,并且值的类型必须注明.</li> <li>常量可以在全局作用域内声明,包括全局作用域</li> <li>常量只能设置为常量表达式,而不能是函数调用的结果或是只能在运行时计算得到的值</li> <li>创建静态常量</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// .toml添加依赖</span>
<span class="token comment">// lazy_static = &quot;1.4.0&quot;</span>
<span class="token attribute attr-name">#[macro_use]</span> <span class="token comment">// 属性: 导入依赖可以像普通库一样使用，还可以使用其中自定义宏</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">lazy_static</span><span class="token punctuation">;</span> <span class="token comment">// 导入lazy_static库</span>
<span class="token comment">// 使用宏</span>
<span class="token macro property">lazy_static!</span><span class="token punctuation">{</span>
    <span class="token comment">// 创建二维数组</span>
    <span class="token keyword">static</span> <span class="token keyword">ref</span> <span class="token constant">MAP</span><span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token punctuation">[</span><span class="token keyword">i32</span><span class="token punctuation">;</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">]</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li>数据类型
1.数据类型:标量类型和复合类型
<ul><li>标量类型： 标量(scalar)类型表示单个值</li> <li>Rust有4个基本的标量类型:整数,浮点,布尔,字符</li> <li>整数(integer):
<ul><li>没有小数部分的数字</li> <li>整数除法会向下取整</li> <li>长度    有符号类型    无符号类型</li> <li>8位     i8            u8</li> <li>16位    i16           u16</li> <li>32位    i32           U32</li> <li>64位    i64           u64</li> <li>128位   i128          u128</li> <li>arch    isize         usize</li> <li>整形字面量</li> <li>数字字面量      示例</li> <li>十进制          98</li> <li>十六进制        0xff</li> <li>八进制          0o77</li> <li>二进制          ob1111</li> <li>字节(仅限于u8)  b'A'</li></ul></li> <li>浮点类型
<ul><li>浮点数是带有小数点的数字,浮点数的基本类型是f32和f64,现在的cpu中速度与f32几乎相同,精度更高.</li></ul></li> <li>所有的浮点数都是有符号的</li> <li>长度    符号类型\</li> <li>32      f32</li> <li>64      f64</li></ul></li></ol> <ul><li>布尔类型
<ul><li>布尔值大小为1字节</li> <li>Rust中的布尔类型也有两个可能的值 true和false</li> <li>长度 符号类型</li> <li>1    bool</li></ul></li> <li>字符类型
<ul><li>Rust的char类型是最基本的字母类型</li> <li>函数入参和返回引用类型可写作  &amp;String</li> <li>字符串 slice： &amp;str &amp;name[..]</li> <li>Rust的字符类型大小为4个字节,表示一个Unicode标量值</li> <li>String使用可变长的UTF-8编码,一个汉字三个字节;</li> <li>长度 符号类型</li> <li>4    char</li></ul></li> <li>复合类型
<ul><li>复合类型可以将多个值组合成一个类型</li> <li>基本复合类型:元组(tuple),数组(array);</li></ul></li> <li>元组类型
<ul><li>元组是将多种类型的值组合到一个复合类型中的一种基本方式.长度固定:声明后就无法增长或缩小</li> <li>创建元组</li> <li>let tup:(i32,f64,u8) = (500,6.6666666,7);</li> <li>解析元组(使用模式匹配来解构)
<ul><li>方法一
<ul><li>let (x,y,z)=tup;</li> <li>创建元组绑定到tup上,使用let匹配tup,分解为三个单独的变量x,y,z</li> <li>这个过程称为解构(destructuring)</li></ul></li> <li>方法二
<ul><li>通过.加上索引</li> <li>tup.1返回500</li> <li>没有任何值的元组</li></ul></li></ul></li></ul></li> <li>()是一种特殊类型,只有一个值,也写成().
<ul><li>该类型被称为单元类型,该值被称为单元值.</li> <li>如果表达式不返回任何其他值,就隐式的返回单元值</li></ul></li> <li>数组类型
<ul><li>将多个相同类型的值组合在一起</li> <li>初始化数组</li> <li>let a = [1,2,3,4,5,6];</li> <li>let a: [i32;5] = [1,2,3,4,5];</li> <li>let a = [3;5]; //初始化为5个3的数组</li> <li>访问数组元素</li> <li>a[索引下标]</li> <li>下标越界会导致运行时错误</li> <li>当你希望将数据分配到stack而不是heap中或是希望确保有固定数量的元素,数组特别有用.</li> <li>如果不确定使用数组还是vector,那就应该使用一个vector(动态数组,可变数组)</li></ul></li> <li>函数
{}是一个表达式
fn add(a:u32,b:u32) -&gt; u32{
let c = {
//带分号是语句
let d = a + b;
//是表达式
d+1
};
println!(&quot;{c}&quot;);
c
}</li> <li>堆与stack
<ul><li>堆上的数据有所有权，直接赋值会更新所有权，之前的变量会失效
<ul><li>使用借用来使用变量 &amp; xx</li> <li>使用可变引用来使用并修改变量 &amp;mut xx</li> <li>借用和可变引用只能同时存在一个</li> <li>借用可同时存在多个</li></ul></li> <li>stack上的数据都是固定大小，可以直接复制值</li></ul></li> <li>slice
<ul><li>[..] 全部长度</li> <li>[0..2] 0 - 2</li> <li>[2..] 2 - 最终</li></ul></li> <li>结构
<ul><li>结构体
<ul><li>创建结构</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Debug)]</span>    <span class="token comment">//使用println!(&quot;{:?}&quot;,class_name);格式化类</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">User</span> <span class="token punctuation">{</span>
    name<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    email<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    sex<span class="token punctuation">:</span> <span class="token keyword">bool</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
<span class="token comment">//构造方法</span>
<span class="token keyword">fn</span> <span class="token function-definition function">build_user</span><span class="token punctuation">(</span>name<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span>email<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">,</span>sex<span class="token punctuation">:</span><span class="token keyword">bool</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
    <span class="token class-name">User</span> <span class="token punctuation">{</span> name<span class="token punctuation">,</span> email<span class="token punctuation">,</span> sex <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">//方法 User.get_info进行调用 self可以调用User内的值 </span>
<span class="token comment">//关键字 Self 在函数的返回类型中代指在 impl 关键字后出现的类型，在这里是 User</span>
<span class="token keyword">impl</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token comment">//&amp;self==self:&amp;self 第一个参数必须有,且是self</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_info</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span>other<span class="token punctuation">:</span><span class="token class-name">User</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> 
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;get_info方法被调用&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>复制,复制后的数据将转换所有权，之前的数据失效</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">let</span> usr <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
    name<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;哈哈&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> 
    email<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;2097925751@qq.com&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    phone<span class="token punctuation">:</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;19216812222&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span> <span class="token comment">//以上属性全部无法使用，所有权更改为usr2</span>

<span class="token keyword">let</span> usr2 <span class="token operator">=</span> <span class="token class-name">User</span><span class="token punctuation">{</span>
    <span class="token punctuation">..</span>usr
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li>元组结构体
<ul><li>使用没有命名字段的元组结构体</li> <li>使用变量解构(a,b,c) 或者使用 .1.2.3索引访问</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">struct</span> <span class="token type-definition class-name">Color</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li>类单元结构体<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">struct</span> <span class="token type-definition class-name">The</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li>枚举<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>
    <span class="token keyword">enum</span> <span class="token type-definition class-name">IpAddrKind</span><span class="token punctuation">{</span>
        <span class="token constant">V4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//可以是基础数据类型</span>
        <span class="token constant">V6</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//可以是一个类</span>
        <span class="token class-name">Info</span><span class="token punctuation">(</span><span class="token keyword">struct</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token comment">//可以是一个元组</span>
        <span class="token class-name">Address</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token keyword">i32</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//枚举类的方法</span>
    <span class="token keyword">impl</span> <span class="token class-name">IpAddrKind</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">getInfo</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//获取枚举类的值，并与match控制流结合</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_message</span><span class="token punctuation">(</span>ipadd<span class="token punctuation">:</span><span class="token class-name">IpAddrKind</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">match</span> ipadd <span class="token punctuation">{</span>
            <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;V4&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token constant">V6</span><span class="token punctuation">(</span>add<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{add}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token class-name">IpAddrKind</span><span class="token punctuation">::</span><span class="token class-name">User</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
                <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}{}{}{}&quot;</span><span class="token punctuation">,</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">,</span>d<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">//Option&lt;T&gt;是标准库内的特殊枚举类,无需导入即可使用</span>
    <span class="token keyword">let</span> a<span class="token punctuation">:</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> b<span class="token punctuation">:</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">None</span><span class="token punctuation">;</span>
    <span class="token comment">//匹配Option&lt;T&gt;内的值需要转换为T</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">get_message</span><span class="token punctuation">(</span>a<span class="token punctuation">:</span><span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">{</span>
        <span class="token keyword">match</span> a <span class="token punctuation">{</span>
            <span class="token class-name">None</span> <span class="token operator">=&gt;</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;None&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Some</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> s
        <span class="token punctuation">}</span>    
    <span class="token punctuation">}</span>
    <span class="token comment">//match中 可以使用_和</span>
    <span class="token keyword">match</span> a <span class="token punctuation">{</span>
        <span class="token number">1</span><span class="token operator">|</span><span class="token number">2</span> <span class="token operator">=</span> <span class="token operator">&gt;</span> <span class="token comment">//匹配到1或2</span>
        <span class="token number">2</span><span class="token punctuation">..</span><span class="token number">5</span> <span class="token operator">=&gt;</span> 匹配到<span class="token number">2</span><span class="token operator">-</span><span class="token number">4</span>之间的数
    <span class="token punctuation">}</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br></div></div></li></ul> <ul><li>控制流<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>
    <span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">:</span><span class="token keyword">while</span> a<span class="token operator">&gt;</span><span class="token number">1</span> <span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>b <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">break</span> <span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">;</span> <span class="token comment">//这会中断外层循环</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">match</span> xx <span class="token punctuation">{</span>
        <span class="token class-name">Ss</span> <span class="token operator">=&gt;</span> ss<span class="token punctuation">,</span>
        <span class="token class-name">Some</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> x<span class="token punctuation">,</span>
        _ <span class="token operator">=&gt;</span> <span class="token punctuation">,</span> <span class="token comment">//</span>
    <span class="token punctuation">}</span>
    
    <span class="token keyword">loop</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
    
    <span class="token comment">//简洁控制流 if let </span>
    <span class="token comment">//是match的语法糖,会丢失简洁性和穷尽性</span>
        <span class="token comment">//options使用简洁控制流</span>
        <span class="token keyword">let</span> config <span class="token operator">=</span> <span class="token class-name">Some</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;666&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token keyword">let</span> <span class="token class-name">Some</span><span class="token punctuation">(</span>max<span class="token punctuation">)</span> <span class="token operator">=</span> config <span class="token punctuation">{</span>
            
        <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div></li> <li>进阶知识
<ul><li>crate是rust在编译时的最小代码单位</li> <li>模块
<ul><li>创建模块<code>cargo new --lib mod</code></li> <li>在模块内定义函数<div class="language- line-numbers-mode"><pre class="language-text"><code>//create::fn::house 绝对路径
//super::house 相对路径
//use 导入
//pub use 重导出
//嵌套导入
//use create::home::{detail,big};
//use create::home::*;引入所有公用域
//使用pub能使当前作用域被上一个作用域所访问，使用::来不断深入作用域
//使用super获取父级作用域下对象
//导入User
use crate::user_mod::User;
//导入的数据添加别名 as
// use crate::user_mod::User as HH;
//use只在所在作用域生效
//    pub use 导出的数据可以被其他的create访问
//    通过 use lib_name::User直接访问
mod user_mod {
    pub enum Sex {
        Yes,
        No
    }
    impl Sex {
        fn get_sex_info(self:&amp;Sex) -&gt; String{
            match self {
                Self::Yes =&gt; &quot;是&quot;.to_string(),
                Self::No =&gt; &quot;否&quot;.to_string()
            }
        }    
    }
    pub struct User{
        name:String,
        sex:String,
        enable:String
    }
    impl User {
        // 构造对象
        pub fn new(name:String,sex:String,enable:&amp;Sex) -&gt; User {
            let is = Sex::get_sex_info(enable);

            User{
                name:String::from(name),
                sex:String::from(sex),
                enable: is
            }
        }
        // 打印对象
        pub fn get_user_info(&amp;self) {
            let mut info = String::new();

            info+=&amp;self.name;

            info+=&quot; &quot;;

            info+=&amp;self.sex;

            info+=&quot; &quot;;

            info+=&amp;self.enable;

            println!(&quot;{info}&quot;);
        }
    }
}
fn main(){
    let liu = User::new(&quot;刘&quot;.to_string(), &quot;男&quot;.to_string(), &amp;user_mod::Sex::Yes);
 
    let xiang = User::new(&quot;相&quot;.to_string(), &quot;女&quot;.to_string(), &amp;user_mod::Sex::No);

    liu.get_user_info();
 
    xiang.get_user_info();
    
    get_user(&amp;xiang)
}
fn get_user(u:&amp;User) {
    u.get_user_info();
}
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div></li> <li>使用外部包
<ul><li>在toml文件中填写外部包的名称和版本，rust将从下载仓库获取包</li></ul></li></ul></li> <li>分包<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token comment">/*
        使用cargo new --lib test 创建项目 会多一个lib.rs用来管理分包
        目录结构
        -src
            -home
                - out.rs
            -home.rs
            -lib.rs
    */</span>
    <span class="token comment">//lib.rs</span>
    <span class="token keyword">mod</span> <span class="token module-declaration namespace">home</span><span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">use</span> <span class="token namespace">create<span class="token punctuation">::</span>home<span class="token punctuation">::</span></span>out<span class="token punctuation">;</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">out_home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        out<span class="token punctuation">.</span><span class="token function">out_home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//home.rs</span>
    <span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">out</span><span class="token punctuation">;</span>
    <span class="token comment">//out.rs</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">out_home</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;我出家了!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li>集合
<ul><li>vector<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//创建集合</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token class-name">Vec</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//使用宏初始化</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> v<span class="token punctuation">:</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token keyword">i32</span><span class="token operator">&gt;</span> <span class="token operator">=</span> vec<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//创建使用enum的集合 结合match来解析数据</span>
    <span class="token keyword">let</span> u <span class="token operator">=</span> <span class="token macro property">vec!</span><span class="token punctuation">[</span><span class="token class-name">Data</span><span class="token punctuation">::</span><span class="token class-name">Int</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">Data</span><span class="token punctuation">::</span><span class="token class-name">Text</span><span class="token punctuation">(</span><span class="token string">&quot;刘相彤&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">//修改集合</span>
    v<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//遍历集合</span>
    <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token operator">&amp;</span>v <span class="token punctuation">{</span>
        out_message <span class="token operator">+=</span> <span class="token operator">&amp;</span>i<span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token comment">//数组越界程序并不会崩溃,而是返回None</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div></li> <li>String
<ul><li>万万没想到,String竟然也是一个集合,意料之外,情理之中</li> <li>String是utf8类型的,由char集合组成</li> <li>String 往往指 String 和 slice str</li> <li>rust字符串不支持索引,可以使用slice来获取 使用utf8编码除了英文其他字符都是两个字节占用</li> <li>使用slice获取字符串索引的时候,注意防止索引不足字符大小,会导致panic程序崩溃</li> <li>创建字符串
<ul><li>let s = String::new(); 创建空字符串</li> <li>let s = &quot;&quot;; 使用字面量值创建字符串</li> <li>let s = &quot;str&quot;.to_string(); 使用to_string创建字符串</li> <li>let s = s.to_string(); 同上</li> <li>let s = String::from(&quot;str&quot;); 使用字面量创建字符串,等同于调用toString;</li></ul></li> <li>修改字符串
<ul><li>增加
<ul><li>push(String/char),push不会获取变量的所有权,使用的是str,slice</li> <li>运算符 + 号,如果直接使用值会获取所有权,需要进行借用</li> <li>format!宏 format!(&quot;{s}---春风不度玉门关&quot;)</li></ul></li></ul></li> <li>遍历字符串
<ul><li>chars() 返回一个char数组.使用for in循环遍历</li> <li>bytes() 返回一个原始字节数组</li></ul></li></ul></li> <li>Hash Map<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">// HashMap默认使用一种叫做SipHash的函数,他可以抵御哈希表的拒绝服务攻击，安全</span>
<span class="token keyword">use</span> <span class="token namespace">std<span class="token punctuation">::</span>collections<span class="token punctuation">::</span></span><span class="token class-name">HashMap</span><span class="token punctuation">;</span>
<span class="token comment">//创建hashmap</span>
<span class="token keyword">let</span> <span class="token keyword">mut</span> scores <span class="token operator">=</span> <span class="token class-name">HashMap</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
<span class="token comment">//插入数据</span>
scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;刘相彤&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;男&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;24岁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
scores<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;香云&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;女&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;24岁&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// 当该键没有数据时就会进行插入</span>
<span class="token comment">// 该方法会返回一个 &amp;mut v可变引用</span>
<span class="token comment">// 使用 * 来解引用就可以根据旧值来改变新值</span>
scores<span class="token punctuation">.</span><span class="token function">entry</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">or_insert</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;黄沙百战穿金甲&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;不破楼兰终不还&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;王昌龄&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">//获取数据</span>
<span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token comment">//获取返回值 类型是Option&lt;&amp;V&gt;</span>
<span class="token keyword">let</span> res <span class="token operator">=</span> scores<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>index<span class="token punctuation">)</span> 
    <span class="token comment">//将返回值获取为 Option&lt;v&gt;</span>
    <span class="token punctuation">.</span><span class="token function">copied</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 
    <span class="token comment">//将键对应的值设置为默认值</span>
    <span class="token punctuation">.</span><span class="token function">unwrap_or</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;get(1).copied() = {} {} {}&quot;</span><span class="token punctuation">,</span>res<span class="token number">.0</span><span class="token punctuation">,</span>res<span class="token number">.1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span>res<span class="token number">.2</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">..</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


<span class="token comment">//遍历数据</span>
<span class="token keyword">for</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span>b<span class="token punctuation">,</span>c<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">in</span> <span class="token operator">&amp;</span>scores<span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{k}:{a},{b},{c}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div></li></ul></li></ul></li></ul> <h2 id="异常处理"><a href="#异常处理" class="header-anchor">#</a> 异常处理</h2> <ul><li>panic意味恐慌,而rust的吉祥物是一个螃蟹,能想象到代码发生异常后rust就像一只慌乱的螃蟹</li> <li>panic会在程序异常时出现或者手动调用panic!宏</li> <li>panic后会展开程序，进行栈回收并清除所有数据。</li> <li>panic后直接终止程序<div class="language-properties line-numbers-mode"><pre class="language-properties"><code><span class="token comment">    #cargo.toml</span>
    [profile.release]
<span class="token key attr-name">    panic</span> <span class="token punctuation">=</span> <span class="token value attr-value">'abort'</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li>返回值为Result或Option的函数
<ul><li>expect(&quot;自定义额外异常信息&quot;);</li> <li>unwrap();默认异常信息</li></ul></li> <li>返回值异常处理<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> content<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unwrap</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//用于返回值为Result的函数中</span>
file<span class="token punctuation">.</span><span class="token function">read_to_string</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> content<span class="token punctuation">)</span><span class="token operator">?</span><span class="token class-name">Err</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token macro property">panic!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li>panic! 宏代表一个程序无法处理的状态</li></ul> <h2 id="泛型-trait和生命周期"><a href="#泛型-trait和生命周期" class="header-anchor">#</a> 泛型,Trait和生命周期</h2> <ul><li>函数中使用泛型<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//进行比较的时候，该数组需要实现了比较的trait 如char i32等</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">other_test</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span><span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">PartialOrd</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>list<span class="token punctuation">:</span><span class="token operator">&amp;</span><span class="token punctuation">[</span><span class="token class-name">T</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> <span class="token keyword">mut</span> max<span class="token operator">=</span><span class="token operator">&amp;</span>list<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> item <span class="token keyword">in</span> list <span class="token punctuation">{</span>
        <span class="token keyword">if</span> item <span class="token operator">&gt;</span> max <span class="token punctuation">{</span>
            max <span class="token operator">=</span> item<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    max
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li>结构体中使用泛型<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//使用两个泛型的 Point，这样 x 和 y 可能是不同类型</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">Point</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    x<span class="token punctuation">:</span> <span class="token class-name">T</span><span class="token punctuation">,</span>
    y<span class="token punctuation">:</span> <span class="token class-name">U</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">fn</span> <span class="token function-definition function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> both_integer <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">10</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> both_float <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">1.0</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> integer_and_float <span class="token operator">=</span> <span class="token class-name">Point</span> <span class="token punctuation">{</span> x<span class="token punctuation">:</span> <span class="token number">5</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token number">4.0</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li>泛型代码的性能
<ul><li>Rust 通过在编译时进行泛型代码的 单态化（monomorphization）</li> <li>为每种不同的值生成一个类型Some_type</li></ul></li> <li>trait
<ul><li>trait定义是一种将方法签名组合起来的方法,目的是定义实现一个目的所必须的行为的集合</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    \\定义<span class="token keyword">trait</span><span class="token punctuation">,</span>并提供默认实现
    <span class="token keyword">pub</span> <span class="token keyword">trait</span> <span class="token type-definition class-name">Summary</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    \\为类型实现<span class="token keyword">trait</span>
    <span class="token type-definition class-name">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">B</span> <span class="token punctuation">{</span>
        <span class="token keyword">pub</span> headline<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
        <span class="token keyword">pub</span> location<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
        <span class="token keyword">pub</span> author<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
        <span class="token keyword">pub</span> content<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token keyword">for</span> <span class="token class-name">B</span> <span class="token punctuation">{</span>
        <span class="token keyword">fn</span> <span class="token function-definition function">summarize</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">String</span> <span class="token punctuation">{</span>
            <span class="token macro property">format!</span><span class="token punctuation">(</span><span class="token string">&quot;文章头部,{}&quot;</span><span class="token punctuation">,</span><span class="token keyword">self</span><span class="token punctuation">.</span>headline<span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    \\调用时需要导入<span class="token keyword">trait</span>包
    <span class="token keyword">use</span> <span class="token punctuation">{</span><span class="token class-name">B</span><span class="token punctuation">,</span><span class="token class-name">Summary</span><span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li>默认实现
<ul><li>需要通过impl Summary for NewsArticle {}</li> <li>一个空的impl块进行实现，会调用默认实现</li></ul></li> <li>trait作为参数，可以接受任何实现了该trait的参数<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token comment">//单个</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Breaking news! {}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">,</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Breaking news! {}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//多个</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token keyword">impl</span> <span class="token class-name">Summary</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Breaking news! {}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    
<span class="token comment">//Trait Bound 语法</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Breaking news! {}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">notify</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Summary</span> <span class="token operator">+</span> <span class="token class-name">Summary</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>item<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Breaking news! {}&quot;</span><span class="token punctuation">,</span> item<span class="token punctuation">.</span><span class="token function">summarize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">fn</span> <span class="token function-definition function">some_function</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">,</span> <span class="token class-name">U</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>t<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">T</span><span class="token punctuation">,</span> u<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">U</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token keyword">i32</span>
<span class="token keyword">where</span>
    <span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span> <span class="token operator">+</span> <span class="token class-name">Clone</span><span class="token punctuation">,</span>
    <span class="token class-name">U</span><span class="token punctuation">:</span> <span class="token class-name">Clone</span> <span class="token operator">+</span> <span class="token class-name">Debug</span><span class="token punctuation">,</span>
<span class="token punctuation">{</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div></li> <li>返回trait -&gt; impl Summary 可以返回任意实现了trait的类型
<ul><li>只存在单一实现了trait的类型</li></ul></li> <li>有条件的实现trait<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//需要实现了Display的trait才能实现ToString的trait</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token punctuation">:</span> <span class="token class-name">Display</span><span class="token operator">&gt;</span> <span class="token class-name">ToString</span> <span class="token keyword">for</span> <span class="token class-name">T</span> <span class="token punctuation">{</span>
    <span class="token comment">// --snip--</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul></li> <li>生命周期确保引用有效
<ul><li>生命周期也是一种泛型</li> <li>生命周期的目的是避免悬垂引用,后者会导致程序引用了非预取引用的数据.</li> <li>生命周期注解语法
<ul><li>使用生命周期注解,说明参数要和类型存在一样久的生命周期</li> <li>&amp;i32 //引用</li> <li>&amp;'a i32 //带有显式生命周期的引用</li> <li>&amp;‘a mut i32 //带有显式生命周期的可变引用</li></ul></li> <li>函数签名中的生命周期注解
<ul><li>泛型生命周期 'a 的具体生命周期等同于 x 和 y 的生命周期中较小的那一个。</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">fn</span> <span class="token function-definition function">longest</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> x<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">&gt;</span> y<span class="token punctuation">.</span><span class="token function">len</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        x
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
        y
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li> <li>结构体定义中的生命周期注解<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//意为ImporttantExcerpt不能比part存在的更久</span>
<span class="token comment">//存放引用需要定义生命周期注解</span>
<span class="token keyword">struct</span> <span class="token type-definition class-name">ImportantExcerpt</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    part<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">str</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>生命周期省略
<ul><li>函数或方法的参数的生命周期被称为 输入生命周期（input lifetimes），而返回值的生命周期被称为 输出生命周期（output lifetimes）。</li> <li>三规则,减少无用代码</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token comment">//一 为参数添加不同生命周期</span>
        函数有一个引用参数的就有一个生命周期参数：<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>，有两个引用参数的函数就有两个不同的生命周期参数，<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token punctuation">,</span> <span class="token lifetime-annotation symbol">'b</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">,</span> y<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'b</span> <span class="token keyword">i32</span><span class="token punctuation">)</span>，依此类推。
    <span class="token comment">//二 一个参数 默认所有生命周期</span>
        第二条规则是如果只有一个输入生命周期参数，那么它被赋予所有输出生命周期参数：<span class="token keyword">fn</span> <span class="token function-definition function">foo</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>x<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'a</span> <span class="token keyword">i32</span>。
    <span class="token comment">//三 对象生命周期自动填充</span>
        第三条规则是如果方法有多个输入生命周期参数并且其中一个参数是 <span class="token operator">&amp;</span><span class="token keyword">self</span> 或 <span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span>，说明是个对象的方法 <span class="token punctuation">(</span>method<span class="token punctuation">)</span><span class="token punctuation">(</span>译者注：这里涉及 rust 的面向对象参见 <span class="token number">17</span> 章<span class="token punctuation">)</span>，那么所有输出生命周期参数被赋予 <span class="token keyword">self</span> 的生命周期。第三条规则使得方法更容易读写，因为只需更少的符号。
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li>方法定义中的生命周期注解<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//impl之后声明生命周期，并在接口体后使用，因为生命周期也是结构体的一部分</span>
<span class="token comment">//这里使用了第三条生命周期注解规则</span>
<span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token class-name">ImportantExcerpt</span><span class="token operator">&lt;</span><span class="token lifetime-annotation symbol">'a</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">announce_and_return_part</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">self</span><span class="token punctuation">,</span> announcement<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token keyword">str</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token keyword">str</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;Attention please: {}&quot;</span><span class="token punctuation">,</span> announcement<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">self</span><span class="token punctuation">.</span>part
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li>静态生命周期<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token keyword">let</span> s<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">'static</span> <span class="token keyword">str</span> <span class="token operator">=</span> <span class="token string">&quot;I have a static lifetime.&quot;</span><span class="token punctuation">;</span>
    生命周期存活于整个程序期间。
    所有字符串字面值都拥有<span class="token lifetime-annotation symbol">'static</span>生命周期
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li></ul> <h2 id="自动化测试"><a href="#自动化测试" class="header-anchor">#</a> 自动化测试</h2> <ul><li>使用<code>cargo test</code>进行自动化测试</li> <li>测试常用宏/注解<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//宏</span>
    <span class="token attribute attr-name">#[test]</span> <span class="token comment">//表示这是一个测试函数</span>
    <span class="token attribute attr-name">#[should_panic(expected = <span class="token string">&quot;&quot;</span>)]</span> <span class="token comment">//测试出现panic时打印的信息</span>
    <span class="token attribute attr-name">#[ignore]</span> <span class="token comment">//忽略当前测试函数</span>
<span class="token comment">//注解    </span>
    <span class="token macro property">assert!</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token operator">/</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">Eq</span><span class="token punctuation">,</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">Eq</span><span class="token punctuation">)</span>
    <span class="token macro property">assert_ne!</span><span class="token punctuation">(</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">Eq</span><span class="token punctuation">,</span><span class="token keyword">impl</span> <span class="token namespace">std<span class="token punctuation">::</span>cmp<span class="token punctuation">::</span></span><span class="token class-name">Eq</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div></li> <li>基础测试
<ul><li><code>#[should_panic(excepted=&quot;&quot;)] 与 Result&lt;T,E&gt; 冲突,不要组合使用 assert!会返回一个Err,为了正常返回,请不要为Result&lt;T,E&gt;值使用问号表达式</code></li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(test)]</span>
<span class="token keyword">pub</span> <span class="token keyword">mod</span> <span class="token module-declaration namespace">auto_test</span> <span class="token punctuation">{</span>
    <span class="token attribute attr-name">#[test]</span> <span class="token comment">//表示这是一个测试函数</span>
    <span class="token attribute attr-name">#[should_panic(expected = <span class="token string">&quot;&quot;</span>)]</span> <span class="token comment">//测试出现panic时打印的信息</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token macro property">assert_eq!</span><span class="token punctuation">(</span>result<span class="token punctuation">,</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//断言</span>
        <span class="token comment">//（true/false,打印painc, 需要打印的值）</span>
        <span class="token comment">// assert!(a.max(&amp;b),&quot;结果不成立{}&quot;,a.max(&amp;b));</span>
    <span class="token punctuation">}</span>
    <span class="token comment">//将Result&lt;T,E&gt;用于测试</span>
    <span class="token attribute attr-name">#[test]</span>
    <span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">it_works</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
        <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token number">2</span> <span class="token operator">+</span> <span class="token number">2</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> result <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">{</span>
            <span class="token class-name">Ok</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token class-name">Err</span><span class="token punctuation">(</span><span class="token string">&quot;结果不相等&quot;</span><span class="token punctuation">.</span><span class="token function">to_string</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>Result简洁,assert复杂</li></ul></li> <li>控制测试
<ul><li>精确控制测试所需的线程 <code>cargo test -- --test-threads=1</code></li> <li>显示函数输出,即程序正确时的输出 <code>cargo test -- --show-output</code></li> <li>指定函数名测试 <code>cargo test workds</code></li> <li>指定多个函数测试符合add开头 <code>cargo test add</code></li></ul></li> <li>单元测试
<ul><li>文件中创建包含测试函数的tests模块 并使用 #[cfg(test)] 标注模块</li> <li>可以测试私有函数</li></ul></li> <li>集成测试
<ul><li>创建一个tests目录</li> <li>创建测试代码 使用#[test]标识函数</li> <li>可以使用 <code>cargo test --test xx xxx</code>来表示需要测试的文件</li></ul></li></ul> <h2 id="迭代器与闭包"><a href="#迭代器与闭包" class="header-anchor">#</a> 迭代器与闭包</h2> <ul><li>闭包,可以捕获其环境的匿名函数
<ul><li>创建闭包: <code>let example_closure = |x| x;</code></li> <li>使用 : <code>example_closure(str) //返回str</code></li> <li>如同同一个闭包两次传入的值不一致，编译器会报错，第一次传入值这个闭包的类型就被锁定</li> <li>一个变量不能被多个闭包同时借用</li> <li>闭包实现修改时必须实现FnMut，即为闭包添加mut</li> <li>可为闭包的参数和返回值增加可选的类型注解</li> <li>创建线程移动变量到线程中使用 使用move移动所有权<div class="language- line-numbers-mode"><pre class="language-text"><code>    thread::spawn(move || println!(&quot;From thread: {:?}&quot;, name))
    .join()
    .unwrap();
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li>迭代器
<ul><li>通过.iter()获取</li> <li>都实现了Iterator trait
<ul><li>内含item和next</li> <li>sum方法获取迭代器的所有权并进行累加</li> <li>产生其他迭代器
<ul><li>iter()不会获取所有权</li> <li>into_iter()会获取所有权</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code> <span class="token comment">//迭代器传入引用，调用clone复制，最后返回新数据，调用collect消费生成新数组</span>
 <span class="token keyword">let</span> hit2<span class="token punctuation">:</span><span class="token class-name">Vec</span><span class="token operator">&lt;</span>stu<span class="token operator">&gt;</span> <span class="token operator">=</span> hit<span class="token punctuation">.</span><span class="token function">iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>h<span class="token punctuation">:</span><span class="token operator">&amp;</span>stu<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">-&gt;</span> stu <span class="token punctuation">{</span> 
    <span class="token keyword">let</span> <span class="token keyword">mut</span> c <span class="token operator">=</span> h<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    c<span class="token punctuation">.</span>hit<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
    c
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//消费迭代器生成数组 源数据并没有改变</span>
<span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{:#?}&quot;</span><span class="token punctuation">,</span>hit2<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//过滤hit大于1的结构</span>
hit<span class="token punctuation">.</span><span class="token function">into_iter</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>s<span class="token closure-punctuation punctuation">|</span></span> s<span class="token punctuation">.</span>hit <span class="token operator">&gt;</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">collect</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li></ul></li> <li>迭代器是 Rust 的 零成本抽象（zero-cost abstractions）之一(也就是说几乎找不到更快的解决方案了)</li></ul></li></ul> <h2 id="智能指针"><a href="#智能指针" class="header-anchor">#</a> 智能指针</h2> <ul><li>Box<T><ul><li>box允许将一个值放在堆上而不是栈上,同样的是一个0开销的技术</li> <li>使用场景
<ul><li>未知大小的类型,再上下文中需要确切类型值的时候</li> <li>大量数据不用拷贝直接转移所有权</li> <li>希望获得的值是实现了某个trait,而不关心具体的类型</li></ul></li> <li>举几个栗子<div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token comment">//sample a 栗子</span>
        <span class="token keyword">let</span> box_char <span class="token operator">=</span> <span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token char">'L'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span>box_char<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token comment">//box递归类型</span>
        <span class="token comment">//使用智能指针创建cons list</span>
        <span class="token comment">//box只解决了间接存储和和堆分配，没有其他特殊功能</span>
        <span class="token comment">//Box创建的对象相当于一个引用，可以用*解引用</span>
        <span class="token keyword">enum</span> <span class="token type-definition class-name">List</span> <span class="token punctuation">{</span>
            <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token keyword">i32</span><span class="token punctuation">,</span><span class="token class-name">Box</span><span class="token operator">&lt;</span><span class="token class-name">List</span><span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token class-name">Nil</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">let</span> list <span class="token operator">=</span> <span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Cons</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token class-name">Box</span><span class="token punctuation">::</span><span class="token function">new</span><span class="token punctuation">(</span><span class="token class-name">Nil</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> <span class="token punctuation">(</span>k<span class="token punctuation">,</span>_v<span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">get_value</span><span class="token punctuation">(</span>list<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token macro property">print!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span>k<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li>函数和方法的隐式转换
<ul><li>Deref 强制转换可以将 &amp;String 转换为 &amp;str,因为String 实现了 Deref trait</li></ul></li> <li>Deref 强制转换如何与可变性交互
<ul><li><p>DerefMut trait 用于重载可变引用的 * 运算符。</p></li> <li><p>Rust 在发现类型和 trait 实现满足三种情况时会进行 Deref 强制转换：</p> <ul><li>当 T: Deref&lt;Target=U&gt; 时从 &amp;T 到 &amp;U。</li> <li>当 T: DerefMut&lt;Target=U&gt; 时从 &amp;mut T 到 &amp;mut U。</li> <li>当 T: Deref&lt;Target=U&gt; 时从 &amp;mut T 到 &amp;U。</li></ul></li></ul></li></ul></T></li> <li>使用DropTrait清理代码
<ul><li>指定在值离开作用域时应该执行的代码的方式是实现 Drop trait</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">impl</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token class-name">Drop</span> <span class="token keyword">for</span> <span class="token class-name">MyBox</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">fn</span> <span class="token function-definition function">drop</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token keyword">mut</span> <span class="token keyword">self</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;自定义指针被清理&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>Rc<T>引用计数
<ul><li>Rc::clone(&amp;a) Rc智能指针和Box类似，但是能进行,进行浅拷贝增加引用计数</li> <li>Rc::strong_count(&amp;a) 根据引用对象查看该数据有几个引用</li> <li>Rc::weak_count(&amp;a) 获取一个弱引用</li> <li>单线程环境中使用，多线程中使用Arc</li></ul></T></li> <li>weak<T>弱引用
<ul><li>weak::weak_count 获取所有的弱引用个数</li> <li>upgrade 返回引用</li></ul></T></li> <li>RefCell 可修改不可变值
<ul><li>在运行时检查借用规则</li> <li>borrow_mut 获取不可变变量的可变引用
<ul><li>返回Ref<T>类型的指针</T></li></ul></li> <li>borrow 获取不可变引用
<ul><li>返回RefMut<T>类型指针</T></li></ul></li> <li>RefCell<T> 在任何时候只允许有多个不可变借用或一个可变借用。</T></li></ul></li> <li>智能指针使用场景
<ul><li>Rc<T> 允许相同数据有多个所有者；Box<T> 和 RefCell<T> 有单一所有者。</T></T></T></li> <li>Box<T> 允许在编译时执行不可变或可变借用检查；Rc<T>仅允许在编译时执行不可变借用检查；RefCell<T> 允许在运行时执行不可变或可变借用检查。</T></T></T></li> <li>因为 RefCell<T> 允许在运行时执行可变借用检查，所以我们可以在即便 RefCell<T> 自身是不可变的情况下修改其内部的值。</T></T></li></ul></li></ul> <h2 id="并发"><a href="#并发" class="header-anchor">#</a> 并发</h2> <ul><li>线程
<ul><li>Rust的线程使用1:1线程实现，这代编每一个语言级线程使用了一个系统线程。</li> <li>某些crate实现了不同于1:1模型的线程取舍</li> <li>thread::spawn 传递一个闭包执行代码</li> <li>thread::sleep(Duration::from_millis(1)); 暂停线程1毫秒</li> <li>JoinHandle是thread::spawn的返回值 调用join能阻塞并等待线程执行完毕</li> <li>move || 能移动被使用变量的所有权 drop可以提前丢弃所有权，使其变量无效</li></ul></li> <li>消息传递
<ul><li>Rust提供了一个信道，将数据从一个线程发送到另一个线程</li> <li>分为发送者transmitter和接收者receiver，任何一方被丢弃认为信道被关闭closed</li> <li>可以通过clone创建多个生产者每个生产者向消费者发送不同消息</li> <li>接收者可以被当作迭代器通多for来使用<div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token keyword">for</span> message <span class="token keyword">in</span> revIter<span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;{}&quot;</span><span class="token punctuation">,</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li>宏
<ul><li>宏分为 声明式宏 和 过程宏</li> <li>过程宏
<ul><li>#[derive] 为目标结构体或枚举派生指定代码</li> <li>类属性宏 为目标添加自定义属性</li> <li>类函数宏 看上去就像函数调用</li></ul></li> <li>宏与函数的区别
<ul><li>减少编写的代码</li></ul></li></ul></li></ul> <h2 id="其他知识点"><a href="#其他知识点" class="header-anchor">#</a> 其他知识点</h2> <ul><li><p>&quot;&quot; 常量字符串是&amp;引用类型</p></li> <li><p>to_string方法是返回String值,而不是    引用,是值复制</p></li> <li><p>&amp;String 可以被 强转（coerced）成 &amp;str 使用了Deref 强制转换（deref coercion）的技术 &amp;String -&gt; &amp;str[..]</p></li> <li><p>Result&lt;E,R&gt;</p> <ul><li>一个特殊的返回值</li> <li>成功返回 Ok(E)</li> <li>失败返回 Err(R)</li> <li>可用unwrap..或excepted自定义异常信息
<ul><li>unwrap(&quot;&quot;)</li> <li>excepted(&quot;&quot;)</li></ul> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code><span class="token comment">//打印错误信息并退出程序</span>
<span class="token function">unwrap_or_else</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>err<span class="token closure-punctuation punctuation">|</span></span><span class="token punctuation">{</span>
    <span class="token macro property">println!</span><span class="token punctuation">(</span><span class="token string">&quot;参数输入错误: {err}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token namespace">process<span class="token punctuation">::</span></span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li> <li>没有发生Err后会自动解构成E</li></ul></li> <li><p>收集程序启动参数及全局变量
<code>std::env::var(&quot;IGNORE_CASE&quot;).is_ok();//获取环境变量是否存在 std::env::args() //获取启动时的参数 第一个默认程序启动路径 linux: IGNORE_CASE=1; cargo run param1 param... windows powershell: $Env:ENV_NAME=1; cargo run 秋 param1 param...</code></p></li> <li><p>特殊注解</p> <div class="language-rust line-numbers-mode"><pre class="language-rust"><code>    <span class="token attribute attr-name">#[derive(Debug)]</span>    <span class="token comment">//使用println!(&quot;{:?}&quot;,class_name);格式化类</span>
    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p>windows环境中文编码错误</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>1、以管理员身份打开powershell，运行下面代码
 New-Item $PROFILE  -ItemType File -Force
2、 打开C盘，找到我的文档中的WindowsPowerShell文件夹
3、编辑这个ps1文件（默认是空的），加上以下代码
$OutputEncoding = [console]::InputEncoding = [console]::OutputEncoding = New-Object System.Text.UTF8Encoding
4、以管理员身份打开powershell，运行下面代码
Set-ExecutionPolicy Unrestricted
按Y确认即可
5、打开powershell，输入chcp，查看代码活动页是否是65001 
```godot
ru</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/doc/document/log4j2.html">
        Log4j2
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/doc/assets/js/app.2b83dd76.js" defer></script><script src="/doc/assets/js/2.469a01de.js" defer></script><script src="/doc/assets/js/1.3a15481a.js" defer></script><script src="/doc/assets/js/27.844e8af5.js" defer></script>
  </body>
</html>
